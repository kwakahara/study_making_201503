select 
	date_format(CNT.D, '%Y-%m-%d') as DATE,
	sum(CNT.J) as JOINED_COUNT,
	sum(CNT.L) as LEFT_COUNT,
	(select 
		sum(CNT2.J - CNT2.L) 
	from
		(select
			U.LEFT_DATE as D,
			0 as J,
			1 as L
		from
			users U
		where
			U.LEFT_DATE is not null 
		union all
	  	select
			U.JOINED_DATE as D,
			1 as J,
			0 as L
		from
			users U 
		) CNT2
	where
		CNT.D >= CNT2.D
	) user_count 
from
	(select
		U.LEFT_DATE as D,
		0 as J,
		1 as L 
	from
		users U 
	where
		U.LEFT_DATE is not null 
	union all 
	select 
		U.JOINED_DATE as D,
		1 as J,
		0 as L 
	from
		users U
	) CNT 
group by CNT.D
order by DATE