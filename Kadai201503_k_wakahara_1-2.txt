select 
	date_format(CNT.DATE, '%Y-%m-%d') DATE,
	sum(CNT.JOIN_CNT) JOINED_COUNT,
	sum(CNT.LEFT_CNT) LEFT_COUNT,
	(select 
		sum(CNT2.JOIN_CNT - CNT2.LEFT_CNT) 
	from
		(select
			USER.LEFT_DATE DATE,
			0 as JOIN_CNT,
			1 as LEFT_CNT
		from
			users USER
		where
			USER.LEFT_DATE is not null 
		union all
	  	select
			USER.JOINED_DATE DATE,
			1 as JOIN_CNT,
			0 as LEFT_CNT
		from
			users USER
		) as CNT2
	where
		CNT.DATE >= CNT2.DATE
	) user_count 
from
	(select
		USER.LEFT_DATE DATE,
		0 as JOIN_CNT,
		1 as LEFT_CNT 
	from
		users USER
	where
		USER.LEFT_DATE is not null 
	union all 
	select 
		USER.JOINED_DATE DATE,
		1 as JOIN_DATE,
		0 as LEFT_DATE 
	from
		users USER
	) as CNT 
group by CNT.DATE
order by DATE