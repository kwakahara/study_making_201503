select 
	date_format(CNT.D, '%Y-%m-%d') as DATE,
	sum(CNT.J) as JOINED_COUNT,
	sum(CNT.L) as LEFT_COUNT,
	(select 
		sum(CNT2.J - CNT2.L) 
	from
		(select
			LEFT_DATE D,
			0 as J,
			1 as L
		from
			users
		where
			LEFT_DATE is not null 
		union all
	  	select
			JOINED_DATE D,
			1 as J,
			0 as L
		from
			users
		) as CNT2
	where
		CNT.D >= CNT2.D
	) as user_count 
from
	(select
		LEFT_DATE D,
		0 as J,
		1 as L 
	from
		users 
	where
		LEFT_DATE is not null 
	union all 
	select 
		JOINED_DATE D,
		1 as J,
		0 as L 
	from
		users
	) as CNT 
group by CNT.D
order by DATE