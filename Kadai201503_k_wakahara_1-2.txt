SELECT
	date_format(cnt.date, '%Y-%m-%d') DATE,
	sum(cnt.join_cnt) JOINED_COUNT,
	sum(cnt.left_cnt) LEFT_COUNT,
	(SELECT 
		sum(cnt2.join_cnt - cnt2.left_cnt) 
	FROM
		(SELECT
			user.LEFT_DATE date,
			0 as join_cnt,
			1 as left_cnt
		FROM
			users user
		WHERE
			user.LEFT_DATE is not null 
		UNION ALL
	  	SELECT
			user.JOINED_DATE date,
			1 as join_cnt,
			0 as left_cnt
		FROM
			users user
		) as cnt2
	WHERE
		cnt.date >= cnt2.date
	) user_count 
FROM
	(SELECT
		user.LEFT_DATE date,
		0 as join_cnt,
		1 as left_cnt 
	FROM
		users user
	WHERE
		user.LEFT_DATE is not null 
	UNION ALL 
	SELECT 
		user.JOINED_DATE date,
		1 as join_date,
		0 as left_date 
	FROM
		users user
	) AS cnt 
GROUP BY cnt.date
ORDER BY date